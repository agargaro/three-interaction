import*as t from"three";import*as e from"three/examples/jsm/lines/Line2";import*as i from"three/examples/jsm/lines/LineGeometry";import*as s from"three/examples/jsm/lines/LineMaterial";var r={d:(t,e)=>{for(var i in e)r.o(e,i)&&!r.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)},n={};r.d(n,{WY:()=>st,KX:()=>it,w9:()=>nt,LK:()=>u,x$:()=>C,Or:()=>w,ZB:()=>v,z2:()=>mt,H7:()=>_,wO:()=>P,Ex:()=>E,kX:()=>y,SP:()=>at,td:()=>ht,hP:()=>M,bx:()=>Y,l_:()=>b,w_:()=>ut,av:()=>_t,Ns:()=>pt,or:()=>et,tg:()=>rt,gb:()=>p,iK:()=>gt,s_:()=>l,cP:()=>vt,DJ:()=>g,RR:()=>m,$C:()=>N,zo:()=>tt,bU:()=>J,MZ:()=>x,jk:()=>c,tL:()=>f,Xp:()=>z,DS:()=>R,NP:()=>W,bn:()=>U,uF:()=>S,EU:()=>A,Lz:()=>Z,zh:()=>G,jp:()=>k,wN:()=>D,BF:()=>I,BD:()=>O,eH:()=>q,KJ:()=>j,dz:()=>T});const a=(o={Clock:()=>t.Clock,Color:()=>t.Color,EventDispatcher:()=>t.EventDispatcher,InstancedInterleavedBuffer:()=>t.InstancedInterleavedBuffer,InstancedMesh:()=>t.InstancedMesh,InterleavedBufferAttribute:()=>t.InterleavedBufferAttribute,MathUtils:()=>t.MathUtils,Matrix4:()=>t.Matrix4,Object3D:()=>t.Object3D,OrthographicCamera:()=>t.OrthographicCamera,PerspectiveCamera:()=>t.PerspectiveCamera,Plane:()=>t.Plane,Quaternion:()=>t.Quaternion,Raycaster:()=>t.Raycaster,Scene:()=>t.Scene,ShaderMaterial:()=>t.ShaderMaterial,Vector2:()=>t.Vector2,Vector3:()=>t.Vector3,Vector4:()=>t.Vector4,WebGLRenderTarget:()=>t.WebGLRenderTarget,WebGLRenderer:()=>t.WebGLRenderer},h={},r.d(h,o),h);var o,h;class c{constructor(){this.dom=document.createElement("div"),this.mode=0,this.frames=0,this.beginTime=(performance||Date).now(),this.prevTime=this.beginTime,this.fpsPanel=this.addPanel(new l("FPS","#0ff","#002")),this.msPanel=this.addPanel(new l("MS","#0f0","#020")),this.dom.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",this.dom.addEventListener("click",(t=>{t.preventDefault(),this.showPanel(++this.mode%this.dom.children.length)}),!1),self.performance&&self.performance.memory&&(this.memPanel=this.addPanel(new l("MB","#f08","#201"))),this.showPanel(0)}addPanel(t){return this.dom.appendChild(t.dom),t}showPanel(t){for(let e=0;e<this.dom.children.length;e++)this.dom.children[e].style.display=e===t?"block":"none";this.mode=t}begin(){this.beginTime=(performance||Date).now()}end(t){!0===t&&this.frames++;const e=(performance||Date).now();if(this.msPanel.update(e-this.beginTime,200),e>=this.prevTime+1e3&&(this.fpsPanel.update(1e3*this.frames/(e-this.prevTime),100),this.prevTime=e,this.frames=0,this.memPanel)){const t=performance.memory;this.memPanel.update(t.usedJSHeapSize/1048576,t.jsHeapSizeLimit/1048576)}return e}update(t){this.beginTime=this.end(t)}}class l{constructor(t,e,i){this.name=t,this.fg=e,this.bg=i,this.min=1/0,this.max=0,this.PR=Math.round(window.devicePixelRatio||1),this.WIDTH=80*this.PR,this.HEIGHT=48*this.PR,this.TEXT_X=3*this.PR,this.TEXT_Y=2*this.PR,this.GRAPH_X=3*this.PR,this.GRAPH_Y=15*this.PR,this.GRAPH_WIDTH=74*this.PR,this.GRAPH_HEIGHT=30*this.PR,this.dom=document.createElement("canvas"),this.dom.width=this.WIDTH,this.dom.height=this.HEIGHT,this.dom.style.cssText="width:80px;height:48px",this.context=this.dom.getContext("2d"),this.context.font="bold "+9*this.PR+"px Helvetica,Arial,sans-serif",this.context.textBaseline="top",this.context.fillStyle=i,this.context.fillRect(0,0,this.WIDTH,this.HEIGHT),this.context.fillStyle=e,this.context.fillText(t,this.TEXT_X,this.TEXT_Y),this.context.fillRect(this.GRAPH_X,this.GRAPH_Y,this.GRAPH_WIDTH,this.GRAPH_HEIGHT),this.context.fillStyle=i,this.context.globalAlpha=.9,this.context.fillRect(this.GRAPH_X,this.GRAPH_Y,this.GRAPH_WIDTH,this.GRAPH_HEIGHT)}update(t,e){this.min=Math.min(this.min,t),this.max=Math.max(this.max,t),this.context.fillStyle=this.bg,this.context.globalAlpha=1,this.context.fillRect(0,0,this.WIDTH,this.GRAPH_Y),this.context.fillStyle=this.fg,this.context.fillText(Math.round(t)+" "+this.name+" ("+Math.round(this.min)+"-"+Math.round(this.max)+")",this.TEXT_X,this.TEXT_Y),this.context.drawImage(this.dom,this.GRAPH_X+this.PR,this.GRAPH_Y,this.GRAPH_WIDTH-this.PR,this.GRAPH_HEIGHT,this.GRAPH_X,this.GRAPH_Y,this.GRAPH_WIDTH-this.PR,this.GRAPH_HEIGHT),this.context.fillRect(this.GRAPH_X+this.GRAPH_WIDTH-this.PR,this.GRAPH_Y,this.PR,this.GRAPH_HEIGHT),this.context.fillStyle=this.bg,this.context.globalAlpha=.9,this.context.fillRect(this.GRAPH_X+this.GRAPH_WIDTH-this.PR,this.GRAPH_Y,this.PR,Math.round((1-t/e)*this.GRAPH_HEIGHT))}}const d=new Set(["auto","default","none","context-menu","help","pointer","progress","wait","cell","crosshair","text","vertical-text","alias","copy","move","no-drop","not-allowed","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out"]);class u{constructor(t){this.enabled=!0,this._domElement=t}update(t,e){var i,s;if(!this.enabled)return;let r;r=t?null!==(i=e.cursorOnDrag)&&void 0!==i?i:"grabbing":e?null!==(s=e.cursorOnHover)&&void 0!==s?s:e.enabled?e.draggable?"grab":"pointer":"default":"default",r!==this._cursor&&(this._cursor=r,d.has(r)?this._domElement.style.cursor=r:this._domElement.style.cursor=`url(${r}), default`)}}class _{get bubbles(){return this._bubbles}get defaultPrevented(){return this._defaultPrevented}get target(){return this._target}get type(){return this._type}constructor(t=!1){this.timeStamp=performance.now(),this.cancelable=t}preventDefault(){this._defaultPrevented=!0}stopImmediatePropagation(){this._stoppedImmediatePropagation=!0}stopPropagation(){this._bubbles=!1}}class p extends _{get altKey(){return this.domEvent.altKey}get button(){return this.domEvent.button}get buttons(){return this.domEvent.buttons}get clientX(){return this.domEvent.clientX}get clientY(){return this.domEvent.clientY}get ctrlKey(){return this.domEvent.ctrlKey}get metaKey(){return this.domEvent.metaKey}get movementX(){return this.domEvent.movementX}get movementY(){return this.domEvent.movementY}get offsetX(){return this.domEvent.offsetX}get offsetY(){return this.domEvent.offsetY}get pageX(){return this.domEvent.pageX}get pageY(){return this.domEvent.pageY}get screenX(){return this.domEvent.screenX}get screenY(){return this.domEvent.screenY}get shiftKey(){return this.domEvent.shiftKey}constructor(t,e,i,s){super(s),this.domEvent=t,this.intersection=e,this.relatedTarget=i}getModifierState(t){return this.domEvent.getModifierState(t)}}class g extends p{get pointerId(){return this.domEvent.pointerId}get width(){return this.domEvent.width}get height(){return this.domEvent.height}get pressure(){return this.domEvent.pressure}get tangentialPressure(){return this.domEvent.tangentialPressure}get tiltX(){return this.domEvent.tiltX}get tiltY(){return this.domEvent.tiltY}get twist(){return this.domEvent.twist}get pointerType(){return this.domEvent.pointerType}get isPrimary(){return this.domEvent.isPrimary}constructor(t,e,i,s){super(t,e,i,s)}getCoalescedEvents(){console.error("getCoalescedEvents not implemented yet.")}getPredictedEvents(){console.error("getPredictedEvents not implemented yet.")}}class v extends g{constructor(t,e=!1,i={},s,r,n){super(t,n,r,e),this.position=s,this.dataTransfer=i}}class m extends _{constructor(t){super(),this.intersection=t}}class f extends p{get deltaMode(){return this.domEvent.deltaMode}get deltaX(){return this.domEvent.deltaX}get deltaY(){return this.domEvent.deltaY}get deltaZ(){return this.domEvent.deltaZ}constructor(t,e){super(t,e)}}class b extends _{get altKey(){return this.domEvent.altKey}get code(){return this.domEvent.code}get ctrlKey(){return this.domEvent.ctrlKey}get key(){return this.domEvent.key}get location(){return this.domEvent.location}get metaKey(){return this.domEvent.metaKey}get repeat(){return this.domEvent.repeat}get shiftKey(){return this.domEvent.shiftKey}constructor(t,e){super(e),this.domEvent=t}getModifierState(t){return this.domEvent.getModifierState(t)}}class y extends _{constructor(t){super(),this.relatedTarget=t}}class x extends _{constructor(t,e,i){super(),this.renderer=t,this.width=e,this.height=i}}class w{constructor(){this._plane=new a.Plane,this._offset=new a.Vector3,this._intersection=new a.Vector3,this._worldPosition=new a.Vector3,this._inverseMatrix=new a.Matrix4,this._startPosition=new a.Vector3,this._targetMatrixWorld=new a.Matrix4,this._findDropTarget=!1}get isDragging(){return!!this._target}get findDropTarget(){return this._findDropTarget}get target(){return this._target}performDrag(t,e,i,s){t.isPrimary&&(this._plane.setFromNormalAndCoplanarPoint(i.getWorldDirection(this._plane.normal),this._worldPosition.setFromMatrixPosition(this._targetMatrixWorld)),e.ray.intersectPlane(this._plane,this._intersection),this._intersection.sub(this._offset).applyMatrix4(this._inverseMatrix),this.triggerEvent("drag",t,this._target,!0,this._intersection,null==s?void 0:s.object,s)._defaultPrevented||this._target.position.equals(this._intersection)||(this._target.position.copy(this._intersection),this._target.updateMatrixWorld(!0)),this.dropTargetEvent(t,s))}startDragging(t,e,i,s){if(t.isPrimary&&s&&s.draggable&&s.clicked){this._target=s,s.dragging=!0,this._startPosition.copy(s.position);const r=this.triggerEvent("dragstart",t,s,!0);return s.updateMatrixWorld(),this._plane.setFromNormalAndCoplanarPoint(i.getWorldDirection(this._plane.normal),this._worldPosition.setFromMatrixPosition(this._target.matrixWorld)),e.ray.intersectPlane(this._plane,this._intersection),this._targetMatrixWorld.copy(this._target.matrixWorld),this._inverseMatrix.copy(this._target.parent.matrixWorld).invert(),this._offset.copy(this._intersection).sub(this._worldPosition.setFromMatrixPosition(this._target.matrixWorld)),this._findDropTarget=r._defaultPrevented,this._findDropTarget&&(this._dataTransfer={}),!0}}cancelDragging(t){this._target&&(this._target.dragging=!1,this.triggerEvent("dragcancel",t,this._target,!0,void 0,this._lastDropTarget)._defaultPrevented||this._target.position.equals(this._startPosition)||this._target.position.copy(this._startPosition),this._lastDropTarget&&this.triggerEvent("dragcancel",t,this._lastDropTarget,!1,void 0,this._target),this.dragEnd(t),this.clear())}stopDragging(t){return!(!this._target||!t.isPrimary||(this._target.dragging=!1,this._lastDropTarget&&this.triggerEvent("drop",t,this._lastDropTarget,!1,void 0,this._target),this.dragEnd(t),this.clear(),0))}dragEnd(t){this.triggerEvent("dragend",t,this._target,!0,void 0,this._lastDropTarget)._defaultPrevented&&this._target.position.copy(this._startPosition)}clear(){this._target=void 0,this._dataTransfer=void 0,this._lastDropTarget=void 0,this._findDropTarget=!1}triggerEvent(t,e,i,s,r,n,a){if(i){const o=new v(e,s,this._dataTransfer,r,n,a);return i.triggerEventAncestor(t,o),o}}dropTargetEvent(t,e){if(this._findDropTarget){const i=null==e?void 0:e.object,s=this._lastDropTarget;this._lastDropTarget=i,i!==s&&(this.triggerEvent("dragleave",t,s,!1,null==e?void 0:e.point,this._target,e),this.triggerEvent("dragenter",t,i,!1,null==e?void 0:e.point,this._target,e)),i&&this.triggerEvent("dragover",t,e.object,!1,e.point,this._target,e)}}}class M{constructor(){this._items=[]}enqueue(t){if("pointermove"===t.type)for(let e=this._items.length-1;e>=0;e--){const i=this._items[e];if(i.pointerId===t.pointerId){const s=i.type;if("pointermove"===s)return void(this._items[e]=t);if("pointercancel"===s||"pointerdown"===s||"pointerout"===s||"pointerover"===s||"pointerup"===s)break}}this._items.push(t)}dequeue(){const t=this._items;return this._items=[],t}}class C{constructor(){this._set=new Set,this.data=[]}push(t){this._set.has(t.id)||(this._set.add(t.id),this.data.push(t))}has(t){return this._set.has(t.id)}remove(t){if(this.has(t)){const e=this.data.indexOf(t);-1!==e&&this.data.splice(e,1),this._set.delete(t.id)}}clear(){this._set=new Set,this.data=[]}}class P{static push(t,e){const i=e.__scene;void 0!==i&&this._allowedEventsSet.has(t)&&this.pushScene(i,t,e)}static update(t){var e,i,s;let r=t.__scene;(null===(e=t.__eventsDispatcher.listeners.rendererresize)||void 0===e?void 0:e.length)>0&&this.pushScene(r,"rendererresize",t),(null===(i=t.__eventsDispatcher.listeners.framerendering)||void 0===i?void 0:i.length)>0&&this.pushScene(r,"framerendering",t),(null===(s=t.__eventsDispatcher.listeners.animate)||void 0===s?void 0:s.length)>0&&this.pushScene(r,"animate",t)}static pushScene(t,e,i){var s,r;const n=null!==(s=this._events[t.id])&&void 0!==s?s:this._events[t.id]={};(null!==(r=n[e])&&void 0!==r?r:n[e]=new C).push(i)}static remove(t,e){const i=this._events[null==e?void 0:e.id];if(void 0!==i)for(const e in i)i[e].remove(t)}static dispatchEvent(t,e,i){const s=this._events[null==t?void 0:t.id];if(s&&s[e])for(const t of s[e].data)t.__eventsDispatcher.dispatchEvent(e,i)}}P._allowedEventsSet=new Set(["rendererresize","framerendering","animate"]),P._events={};class E{constructor(t){this.parent=t,this.listeners={}}addEventListener(t,e){return void 0===this.listeners[t]&&(this.listeners[t]=[],this.parent.isObject3D&&(P.push(t,this.parent),"positionchange"===t||"scalechange"===t?U(this.parent):"rotationchange"===t&&W(this.parent))),-1===this.listeners[t].indexOf(e)&&this.listeners[t].push(e),e}hasEventListener(t,e){var i,s;return!(null===(s=null===(i=this.listeners[t])||void 0===i?void 0:i.indexOf(e))||void 0===s||!s)}removeEventListener(t,e){var i,s;const r=null!==(s=null===(i=this.listeners[t])||void 0===i?void 0:i.indexOf(e))&&void 0!==s?s:-1;-1!==r&&this.listeners[t].splice(r,1)}dispatchDOMEvent(t,e){e._bubbles=!1,e._stoppedImmediatePropagation=!1,e._defaultPrevented=!1,e._type=t,e._target=this.parent,this._dispatchDOMEvent(t,e)}_dispatchDOMEvent(t,e){if(!this.listeners[t])return;const i=e.currentTarget=this.parent;for(const s of this.listeners[t]){if(e._stoppedImmediatePropagation)break;s.call(i,e)}}dispatchDOMEventAncestor(t,e){let i=this.parent;for(e._bubbles=!0,e._stoppedImmediatePropagation=!1,e._defaultPrevented=!1,e._type=t,e._target=i;i&&e._bubbles;)i.__eventsDispatcher._dispatchDOMEvent(t,e),i=i.parent}dispatchEvent(t,e){if(this.listeners[t])for(const i of this.listeners[t])i.call(this.parent,e)}}function z(t){t.__onChangeCallbackBase=t.rotation._onChangeCallback,void 0!==t.__scene&&(!0===t.__scene.__smartRendering?D(t):k(t))}function D(t){t.rotation._onChangeCallback=()=>{t.__onChangeCallbackBase(),t.__scene.__needsRender=!0,t.__eventsDispatcher.dispatchEvent("rotationchange")}}function k(t){t.rotation._onChangeCallback=()=>{t.__onChangeCallbackBase(),t.__eventsDispatcher.dispatchEvent("rotationchange")}}function R(t){t.matrix.compose=function(t,e,i){const s=this.elements,r=e._x,n=e._y,a=e._z,o=e._w,h=r+r,c=n+n,l=a+a,d=r*h,u=r*c,_=r*l,p=n*c,g=n*l,v=a*l,m=o*h,f=o*c,b=o*l,y=i._x,x=i._y,w=i._z;return s[0]=(1-(p+v))*y,s[1]=(u+b)*y,s[2]=(_-f)*y,s[3]=0,s[4]=(u-b)*x,s[5]=(1-(d+v))*x,s[6]=(g+m)*x,s[7]=0,s[8]=(_+f)*w,s[9]=(g-m)*w,s[10]=(1-(d+p))*w,s[11]=0,s[12]=t._x,s[13]=t._y,s[14]=t._z,s[15]=1,this}}function S(t){t.__onChangeCallbackBase=t.quaternion._onChangeCallback,void 0!==t.__scene&&(!0===t.__scene.__smartRendering?O(t):I(t))}function O(t){t.quaternion._onChangeCallback=()=>{t.__onChangeCallbackBase(),t.__scene.__needsRender=!0,t.__eventsDispatcher.dispatchEvent("rotationchange")}}function I(t){t.quaternion._onChangeCallback=()=>{t.__onChangeCallbackBase(),t.__eventsDispatcher.dispatchEvent("rotationchange")}}function A(t){V(t.position),V(t.scale),void 0!==t.__scene&&(!0===t.__scene.__smartRendering?T(t):j(t))}function T(t){t.position._onChangeCallback=()=>{t.__scene.__needsRender=!0,t.__eventsDispatcher.dispatchEvent("positionchange")},t.scale._onChangeCallback=()=>{t.__scene.__needsRender=!0,t.__eventsDispatcher.dispatchEvent("scalechange")}}function j(t){t.position._onChangeCallback=()=>{t.__eventsDispatcher.dispatchEvent("positionchange")},t.scale._onChangeCallback=()=>{t.__eventsDispatcher.dispatchEvent("scalechange")}}function V(t){t._x=t.x,t._y=t.y,t._z=t.z,t.isVector3=!0,Object.setPrototypeOf(t,H.prototype),Object.defineProperties(t,{x:{get(){return this._x},set(t){this._x=t,this._onChangeCallback()}},y:{get(){return this._y},set(t){this._y=t,this._onChangeCallback()}},z:{get(){return this._z},set(t){this._z=t,this._onChangeCallback()}}})}class H{set(t,e,i){return void 0===i&&(i=this._z),this._x=t,this._y=e,this._z=i,this._onChangeCallback(),this}setScalar(t){return this._x=t,this._y=t,this._z=t,this._onChangeCallback(),this}setX(t){return this._x=t,this._onChangeCallback(),this}setY(t){return this._y=t,this._onChangeCallback(),this}setZ(t){return this._z=t,this._onChangeCallback(),this}setComponent(t,e){switch(t){case 0:this._x=e;break;case 1:this._y=e;break;case 2:this._z=e;break;default:throw new Error("index is out of range: "+t)}return this._onChangeCallback(),this}getComponent(t){switch(t){case 0:return this._x;case 1:return this._y;case 2:return this._z;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this._x,this._y,this._z)}copy(t,e){return this._x=t.x,this._y=t.y,this._z=t.z,!1!==e&&this._onChangeCallback(),this}add(t){return this._x+=t.x,this._y+=t.y,this._z+=t.z,this._onChangeCallback(),this}addScalar(t){return this._x+=t,this._y+=t,this._z+=t,this._onChangeCallback(),this}addVectors(t,e){return this._x=t.x+e.x,this._y=t.y+e.y,this._z=t.z+e.z,this._onChangeCallback(),this}addScaledVector(t,e){return this._x+=t.x*e,this._y+=t.y*e,this._z+=t.z*e,this._onChangeCallback(),this}sub(t){return this._x-=t.x,this._y-=t.y,this._z-=t.z,this._onChangeCallback(),this}subScalar(t){return this._x-=t,this._y-=t,this._z-=t,this._onChangeCallback(),this}subVectors(t,e){return this._x=t.x-e.x,this._y=t.y-e.y,this._z=t.z-e.z,this._onChangeCallback(),this}multiply(t){return this._x*=t.x,this._y*=t.y,this._z*=t.z,this._onChangeCallback(),this}multiplyScalar(t,e){return this._x*=t,this._y*=t,this._z*=t,!1!==e&&this._onChangeCallback(),this}multiplyVectors(t,e){return this._x=t.x*e.x,this._y=t.y*e.y,this._z=t.z*e.z,this._onChangeCallback(),this}applyEuler(t){return this.applyQuaternion(B.setFromEuler(t))}applyAxisAngle(t,e){return this.applyQuaternion(B.setFromAxisAngle(t,e))}applyMatrix3(t,e){const i=this._x,s=this._y,r=this._z,n=t.elements;return this._x=n[0]*i+n[3]*s+n[6]*r,this._y=n[1]*i+n[4]*s+n[7]*r,this._z=n[2]*i+n[5]*s+n[8]*r,!1!==e&&this._onChangeCallback(),this}applyNormalMatrix(t){return this.applyMatrix3(t,!1).normalize()}applyMatrix4(t,e){const i=this._x,s=this._y,r=this._z,n=t.elements,a=1/(n[3]*i+n[7]*s+n[11]*r+n[15]);return this._x=(n[0]*i+n[4]*s+n[8]*r+n[12])*a,this._y=(n[1]*i+n[5]*s+n[9]*r+n[13])*a,this._z=(n[2]*i+n[6]*s+n[10]*r+n[14])*a,!1!==e&&this._onChangeCallback(),this}applyQuaternion(t){const e=this._x,i=this._y,s=this._z,r=t.x,n=t.y,a=t.z,o=t.w,h=o*e+n*s-a*i,c=o*i+a*e-r*s,l=o*s+r*i-n*e,d=-r*e-n*i-a*s;return this._x=h*o+d*-r+c*-a-l*-n,this._y=c*o+d*-n+l*-r-h*-a,this._z=l*o+d*-a+h*-n-c*-r,this._onChangeCallback(),this}project(t){return this.applyMatrix4(t.matrixWorldInverse,!1).applyMatrix4(t.projectionMatrix)}unproject(t){return this.applyMatrix4(t.projectionMatrixInverse,!1).applyMatrix4(t.matrixWorld)}transformDirection(t){const e=this._x,i=this._y,s=this._z,r=t.elements;return this._x=r[0]*e+r[4]*i+r[8]*s,this._y=r[1]*e+r[5]*i+r[9]*s,this._z=r[2]*e+r[6]*i+r[10]*s,this.normalize()}divide(t){return this._x/=t.x,this._y/=t.y,this._z/=t.z,this._onChangeCallback(),this}divideScalar(t,e){return this.multiplyScalar(1/t,e)}min(t){return this._x=Math.min(this._x,t.x),this._y=Math.min(this._y,t.y),this._z=Math.min(this._z,t.z),this._onChangeCallback(),this}max(t){return this._x=Math.max(this._x,t.x),this._y=Math.max(this._y,t.y),this._z=Math.max(this._z,t.z),this._onChangeCallback(),this}clamp(t,e){return this._x=Math.max(t.x,Math.min(e.x,this._x)),this._y=Math.max(t.y,Math.min(e.y,this._y)),this._z=Math.max(t.z,Math.min(e.z,this._z)),this._onChangeCallback(),this}clampScalar(t,e){return this._x=Math.max(t,Math.min(e,this._x)),this._y=Math.max(t,Math.min(e,this._y)),this._z=Math.max(t,Math.min(e,this._z)),this._onChangeCallback(),this}clampLength(t,e){const i=this.length();return this.divideScalar(i||1,!1).multiplyScalar(Math.max(t,Math.min(e,i)))}floor(){return this._x=Math.floor(this._x),this._y=Math.floor(this._y),this._z=Math.floor(this._z),this._onChangeCallback(),this}ceil(){return this._x=Math.ceil(this._x),this._y=Math.ceil(this._y),this._z=Math.ceil(this._z),this._onChangeCallback(),this}round(){return this._x=Math.round(this._x),this._y=Math.round(this._y),this._z=Math.round(this._z),this._onChangeCallback(),this}roundToZero(){return this._x=this._x<0?Math.ceil(this._x):Math.floor(this._x),this._y=this._y<0?Math.ceil(this._y):Math.floor(this._y),this._z=this._z<0?Math.ceil(this._z):Math.floor(this._z),this._onChangeCallback(),this}negate(){return this._x=-this._x,this._y=-this._y,this._z=-this._z,this._onChangeCallback(),this}dot(t){return this._x*t.x+this._y*t.y+this._z*t.z}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z)}manhattanLength(){return Math.abs(this._x)+Math.abs(this._y)+Math.abs(this._z)}normalize(t){return this.divideScalar(this.length()||1,t)}setLength(t){return this.normalize(!1).multiplyScalar(t)}lerp(t,e){return this._x+=(t.x-this._x)*e,this._y+=(t.y-this._y)*e,this._z+=(t.z-this._z)*e,this._onChangeCallback(),this}lerpVectors(t,e,i){return this._x=t.x+(e.x-t.x)*i,this._y=t.y+(e.y-t.y)*i,this._z=t.z+(e.z-t.z)*i,this._onChangeCallback(),this}cross(t){return this.crossVectors(this,t)}crossVectors(t,e){const i=t.x,s=t.y,r=t.z,n=e.x,a=e.y,o=e.z;return this._x=s*o-r*a,this._y=r*n-i*o,this._z=i*a-s*n,this._onChangeCallback(),this}projectOnVector(t){const e=t.lengthSq();if(0===e)return this.set(0,0,0);const i=t.dot(this)/e;return this.copy(t,!1).multiplyScalar(i)}projectOnPlane(t){return L.copy(this).projectOnVector(t),this.sub(L)}reflect(t){return this.sub(L.copy(t).multiplyScalar(2*this.dot(t)))}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(0===e)return Math.PI/2;const i=this.dot(t)/e;return Math.acos(a.MathUtils.clamp(i,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this._x-t.x,i=this._y-t.y,s=this._z-t.z;return e*e+i*i+s*s}manhattanDistanceTo(t){return Math.abs(this._x-t.x)+Math.abs(this._y-t.y)+Math.abs(this._z-t.z)}setFromSpherical(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}setFromSphericalCoords(t,e,i){const s=Math.sin(e)*t;return this._x=s*Math.sin(i),this._y=Math.cos(e)*t,this._z=s*Math.cos(i),this._onChangeCallback(),this}setFromCylindrical(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}setFromCylindricalCoords(t,e,i){return this._x=t*Math.sin(e),this._y=i,this._z=t*Math.cos(e),this._onChangeCallback(),this}setFromMatrixPosition(t){const e=t.elements;return this._x=e[12],this._y=e[13],this._z=e[14],this._onChangeCallback(),this}setFromMatrixScale(t){const e=this.setFromMatrixColumn(t,0).length(),i=this.setFromMatrixColumn(t,1).length(),s=this.setFromMatrixColumn(t,2).length();return this._x=e,this._y=i,this._z=s,this._onChangeCallback(),this}setFromMatrixColumn(t,e){return this.fromArray(t.elements,4*e)}setFromMatrix3Column(t,e){return this.fromArray(t.elements,3*e)}setFromEuler(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._onChangeCallback(),this}setFromColor(t){return this._x=t.r,this._y=t.g,this._z=t.b,this._onChangeCallback(),this}equals(t){return t.x===this._x&&t.y===this._y&&t.z===this._z}fromArray(t,e=0){return this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t}fromBufferAttribute(t,e){return this._x=t.getX(e),this._y=t.getY(e),this._z=t.getZ(e),this._onChangeCallback(),this}random(){return this._x=Math.random(),this._y=Math.random(),this._z=Math.random(),this._onChangeCallback(),this}randomDirection(){const t=2*(Math.random()-.5),e=Math.random()*Math.PI*2,i=Math.sqrt(1-Math.pow(t,2));return this._x=i*Math.cos(e),this._y=i*Math.sin(e),this._z=t,this._onChangeCallback(),this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z}}const L=new a.Vector3,B=new a.Quaternion,G={};function U(t){!0!==t.__vec3Patched&&(A(t),R(t),t.__vec3Patched=!0)}function W(t){!0!==t.__rotationPatched&&(S(t),z(t),t.__rotationPatched=!0)}a.Object3D.prototype.activable=!0,a.Object3D.prototype.active=!1,a.Object3D.prototype.clicked=!1,a.Object3D.prototype.dragging=!1,a.Object3D.prototype.draggable=!1,a.Object3D.prototype.hovered=!1,a.Object3D.prototype.interceptByRaycaster=!0,a.Object3D.prototype.enabled=!0,a.Object3D.prototype.__manualDetection=!1,Object.defineProperty(a.Object3D.prototype,"activableObj",{get:function(){let t=this;for(;t&&!t.activable;)t=t.parent;return t},configurable:!0}),a.Object3D.prototype.needsRender=function(){void 0!==this.__scene&&(this.__scene.__needsRender=!0)},a.Object3D.prototype.bindEvent=function(t,e){if("string"==typeof t)return this.__eventsDispatcher.addEventListener(t,e);for(const i of t)this.__eventsDispatcher.addEventListener(i,e);return e},a.Object3D.prototype.hasBoundEvent=function(t,e){return this.__eventsDispatcher.hasEventListener(t,e)},a.Object3D.prototype.unbindEvent=function(t,e){this.__eventsDispatcher.removeEventListener(t,e)},a.Object3D.prototype.triggerEvent=function(t,e){this.__eventsDispatcher.dispatchDOMEvent(t,e)},a.Object3D.prototype.triggerEventAncestor=function(t,e){this.__eventsDispatcher.dispatchDOMEventAncestor(t,e)},Object.defineProperty(a.Object3D.prototype,"userData",{set:function(t){this.__eventsDispatcher=new E(this),Object.defineProperty(this,"userData",{value:t,writable:!0,configurable:!0})},configurable:!0}),a.Object3D.prototype.setManualDetectionMode=function(){it.setManualDetectionMode(this)},a.Object3D.prototype.detectChanges=function(){it.detectChanges(this)},a.Object3D.prototype.bindProperty=function(t,e,i){return it.bindProperty(t,this,e,i),this},a.Object3D.prototype.unbindProperty=function(t){return it.unbindProperty(this,t),this};const F=a.Object3D.prototype.add;a.Object3D.prototype.add=function(t){return F.call(this,...arguments),1===arguments.length&&t!==this&&!0===(null==t?void 0:t.isObject3D)&&(!0===this.isScene&&(this.__scene=this),void 0!==this.__scene&&(q(t,this.__scene),this.__scene.__needsRender=!0)),this};const X=a.Object3D.prototype.remove;function q(t,e){t.__scene=e,P.update(t),G[t.id]=t,function(t){if(!0===t.__scene.__smartRendering&&!0!==t.__smartRenderingPatched){U(t),W(t),T(t),O(t),D(t);const e=Object.getOwnPropertyDescriptor(t,"visible");void 0!==e&&void 0===e.get&&(t.__visible=t.visible,Object.defineProperty(t,"visible",{get:function(){return this.__visible},set:function(t){this.__visible=t,this.needsRender()},configurable:!0}));const i=Object.getOwnPropertyDescriptor(t,"enabled");void 0!==i&&void 0===i.get&&(t.__enabled=t.enabled,Object.defineProperty(t,"enabled",{get:function(){return this.__enabled},set:function(t){this.__enabled=t,this.needsRender()},configurable:!0})),t.__smartRenderingPatched=!0}}(t);for(const i of t.children)q(i,e)}function K(t){P.remove(t,t.__scene),G[t.id]=void 0,function(t){!0===t.__smartRenderingPatched&&(j(t),I(t),k(t),Object.defineProperty(t,"visible",{value:t.__visible,writable:!0,configurable:!0}),Object.defineProperty(t,"enabled",{value:t.__enabled,writable:!0,configurable:!0}),t.__smartRenderingPatched=!1)}(t),t.__scene=void 0;for(const e of t.children)K(e)}a.Object3D.prototype.remove=function(t){return 1==arguments.length&&-1!==this.children.indexOf(t)&&void 0!==this.__scene&&(K(t),this.__scene.__needsRender=!0),X.call(this,...arguments),this};class N{constructor(t){this.raycaster=new a.Raycaster,this.intersectionSortComparer=(t,e)=>t.distance-e.distance,this.raycastGPU=!1,this._pickingTexture=new a.WebGLRenderTarget(1,1),this._pointer=new a.Vector2,this._pointerNormalized=new a.Vector2,this._renderManager=t,this._renderer=t.renderer}getIntersections(t,e,i){const s=[];if(this._pointer.set(t.offsetX,t.offsetY),!0===this._renderManager.getNormalizedMouse(this._pointer,this._pointerNormalized)){const t=this._renderManager.activeView.scene,r=this._renderManager.activeView.camera;this.raycaster.setFromCamera(this._pointerNormalized,r),!1!==e&&void 0===i||(this.raycastGPU?this.raycastObjectsGPU(t,r,s,i):this.raycastObjects(t,s,i)),s.sort(this.intersectionSortComparer)}return s}raycastObjects(t,e,i){if(t!==i){if(!0===t.interceptByRaycaster&&!0===t.visible){for(const s of t.children)this.raycastObjects(s,e,i);let s=e.length;for(void 0!==t.objectsToRaycast?this.raycaster.intersectObjects(t.objectsToRaycast,!1,e):this.raycaster.intersectObject(t,!1,e);e.length>s;){const i=e[s];i.hitbox=i.object,i.object=t,s++}}return e}}raycastObjectsGPU(t,e,i,s){const r=this._renderer.domElement.width,n=this._renderer.domElement.height;e.setViewOffset(r,n,this._pointer.x*devicePixelRatio,this._pointer.y*devicePixelRatio,1,1),this._renderer.setRenderTarget(this._pickingTexture),this._renderer.render(t,e),e.clearViewOffset();const a=new Uint8Array(4);this._renderer.readRenderTargetPixels(this._pickingTexture,0,0,1,1,a);const o=a[0]<<16|a[1]<<8|a[2];this._renderer.setRenderTarget(null);const h=G[o];if(h){h.objectsToRaycast?this.raycaster.intersectObjects(h.objectsToRaycast,!1,i):this.raycaster.intersectObject(h,!1,i);for(const t of i)t.hitbox=t.object,t.object=h}return i}}class Y{constructor(t){this.enabled=!0,this.continousRaycasting=!0,this.continousRaycastingDrop=!0,this.disactiveWhenClickOut=!1,this.intersection={},this._queue=new M,this._dragManager=new w,this._lastPointerDownExt={},this._lastPointerDown={},this._lastPointerMove={},this._lastIntersection={},this._mouseDetected=!1,this._isTapping=!1,this._renderManager=t;const e=t.renderer;this.registerRenderer(e),this._cursorManager=new u(e.domElement),this.raycasterManager=new N(t)}registerRenderer(t){t instanceof a.WebGLRenderer?(t.domElement.addEventListener("pointermove",(t=>this._mouseDetected="mouse"===t.pointerType)),t.domElement.addEventListener("pointerdown",(t=>this._isTapping="mouse"!==t.pointerType&&t.isPrimary)),t.domElement.addEventListener("pointerup",(t=>this._isTapping&&(this._isTapping=!t.isPrimary))),this.bindEvents(t)):console.error("Renderer not supported.")}bindEvents(t){const e=t.domElement;e.addEventListener("pointercancel",this.enqueue.bind(this)),e.addEventListener("pointerdown",this.enqueue.bind(this)),e.addEventListener("pointermove",this.enqueue.bind(this)),e.addEventListener("pointerup",this.enqueue.bind(this)),e.addEventListener("wheel",this.enqueue.bind(this)),document.addEventListener("keydown",this.enqueue.bind(this)),document.addEventListener("keyup",this.enqueue.bind(this))}enqueue(t){this._queue.enqueue(t)}update(){var t;if(this.enabled){this._primaryRaycasted=!1;for(const t of this._queue.dequeue())this.computeQueuedEvent(t);this.pointerIntersection(),this._cursorManager.update(this._dragManager.target,null===(t=this.intersection[this._primaryIdentifier])||void 0===t?void 0:t.object)}}raycastScene(t){if(t.isPrimary&&(this._primaryRaycasted=!0,this._primaryIdentifier=t.pointerId),this._dragManager.isDragging){const e=this.raycasterManager.getIntersections(t,!0,!0===this._dragManager.findDropTarget?this._dragManager.target:void 0);this.intersectionDropTarget=e[0]}else{this._lastIntersection[t.pointerId]=this.intersection[t.pointerId];const e=this.raycasterManager.getIntersections(t,!1);this.intersection[t.pointerId]=e[0]}}triggerPointer(t,e,i,s){if(i){const r=new g(e,this.intersection[e.pointerId],s);i.triggerEvent(t,r)}}triggerAncestorPointer(t,e,i,s,r){if(i){const n=new g(e,this.intersection[e.pointerId],s,r);return i.triggerEventAncestor(t,n),n}}triggerAncestorWheel(t,e){if(e){const i=new f(t,e);e.object.triggerEventAncestor("wheel",i)}}triggerAncestorKeyboard(t,e,i){if(this.activeObject){const s=new b(e,i);return this.activeObject.triggerEventAncestor(t,s),s}}computeQueuedEvent(t){switch(t.type){case"pointermove":return this.pointerMove(t);case"pointerdown":return this.pointerDown(t);case"pointerup":return this.pointerUp(t);case"wheel":return this.wheel(t);case"keydown":return this.keyDown(t);case"keyup":return this.keyUp(t);default:console.error("Error: computeEvent failed.")}}isMainClick(t){return t.isPrimary&&("mouse"===t.pointerType&&0===t.button||"mouse"!==t.pointerType)}pointerDown(t){var e;"mouse"!==t.pointerType&&this.pointerMove(t);const i=null===(e=this.intersection[t.pointerId])||void 0===e?void 0:e.object,s=this.triggerAncestorPointer("pointerdown",t,i,void 0,!0);this._lastPointerDown[t.pointerId]=t,this._lastPointerDownExt[t.pointerId]=s,i&&(i.clicked=this.isMainClick(t)),(null==s?void 0:s._defaultPrevented)||this.focus(t,i)}pointerMove(t){var e;if(this._lastPointerMove[t.pointerId]=t,this.raycastScene(t),this._dragManager.isDragging)this._dragManager.performDrag(t,this.raycasterManager.raycaster,this._renderManager.activeView.camera,this.intersectionDropTarget);else{this.pointerOutOver(t);const i=null===(e=this.intersection[t.pointerId])||void 0===e?void 0:e.object;this._dragManager.startDragging(t,this.raycasterManager.raycaster,this._renderManager.activeView.camera,i)||this.triggerAncestorPointer("pointermove",t,i)}}pointerIntersection(){if(this._dragManager.isDragging){if(!this._primaryRaycasted&&this._dragManager.findDropTarget&&this.continousRaycastingDrop){const t=this._lastPointerMove[this._primaryIdentifier]||this._lastPointerDown[this._primaryIdentifier];this.raycastScene(t),this._dragManager.performDrag(t,this.raycasterManager.raycaster,this._renderManager.activeView.camera,this.intersectionDropTarget)}}else if(this.continousRaycasting&&(this._mouseDetected||this._isTapping)){if(!this._primaryRaycasted){const t=this._lastPointerMove[this._primaryIdentifier]||this._lastPointerDown[this._primaryIdentifier];this.raycastScene(t),this.pointerOutOver(t)}const t=this.intersection[this._primaryIdentifier];null==t||t.object.triggerEventAncestor("pointerintersection",new m(t))}}wheel(t){this.triggerAncestorWheel(t,this.intersection[this._primaryIdentifier])}pointerOutOver(t){var e,i;const s=null===(e=this.intersection[t.pointerId])||void 0===e?void 0:e.object,r=null===(i=this._lastIntersection[t.pointerId])||void 0===i?void 0:i.object;t.isPrimary&&(r&&(r.hovered=!1),s&&(s.hovered=!0)),s!==r&&(this.triggerAncestorPointer("pointerout",t,r,s),this.triggerPointer("pointerleave",t,r,s),this.triggerAncestorPointer("pointerover",t,s,r),this.triggerPointer("pointerenter",t,s,r))}pointerUp(t){var e,i;const s=null===(e=this.intersection[t.pointerId])||void 0===e?void 0:e.object,r=null===(i=this._lastPointerDownExt[t.pointerId])||void 0===i?void 0:i._target;let n;"mouse"!==t.pointerType&&s&&(s.hovered=!1,this.triggerAncestorPointer("pointerout",t,s),this.triggerPointer("pointerleave",t,s)),this._dragManager.stopDragging(t)||(this.triggerAncestorPointer("pointerup",t,s,r),s&&s===r&&(n=this.triggerAncestorPointer("click",t,s))),this._lastClick=this.dblClick(t,n,s),r&&this.isMainClick(t)&&(r.clicked=!1)}dblClick(t,e,i){if(this.isMainClick(t)&&e){const s=this._lastClick;return i===(null==s?void 0:s._target)&&t.timeStamp-s.timeStamp<=300?void this.triggerAncestorPointer("dblclick",t,i):e}}keyDown(t){const e=this.triggerAncestorKeyboard("keydown",t,!0);(null==e?void 0:e._defaultPrevented)||"Escape"!==t.key&&"Esc"!==t.key||this._dragManager.cancelDragging(this._lastPointerMove[this._primaryIdentifier])}keyUp(t){this.triggerAncestorKeyboard("keyup",t,!1)}focus(t,e){if(!t.isPrimary)return;const i=null==e?void 0:e.activableObj;if(this.activeObject!==i){if(!this.disactiveWhenClickOut&&!i)return;const t=new y(i),e=this.activeObject;e&&(e.active=!1,e.triggerEventAncestor("blur",t),e.triggerEvent("focusout",t)),i&&(i.active=!0,t.relatedTarget=e,i.triggerEventAncestor("focus",t),i.triggerEvent("focusin",t)),this.activeObject=i,this._renderManager.activeView.scene.__needsRender=!0}}}const Q=new a.Vector4,$=new a.Vector4;function Z(t){const e=t.render.bind(t);t.render=function(t,i){this.getViewport(Q),function(t,e){$.z===Q.z&&$.w===Q.w||($.copy(Q),P.dispatchEvent(e,"rendererresize",new x(t,Q.z,Q.w)))}(this,t),this.__isGPUPicking&&(this.__isGPUPicking=!1),e(t,i)}}class J{constructor(t,e){var i,s;this.viewport={left:0,bottom:0,width:0,height:0},this._rendererSize=e,this.scene=t.scene,this.camera=t.camera,this.viewportNormalized=t.viewport,this.name=t.name,this.visible=null===(i=t.visible)||void 0===i||i,this.enabled=null===(s=t.enabled)||void 0===s||s,this.backgroundAlpha=t.backgroundAlpha,this.backgroundColor="number"==typeof t.backgroundColor?new a.Color(t.backgroundColor):t.backgroundColor,this._onBeforeRender=t.onBeforeRender,this._onAfterRender=t.onAfterRender,this.scene.add(this.camera),this.update()}update(){void 0!==this.viewportNormalized?(this.viewport.left=Math.floor(this._rendererSize.x*this.viewportNormalized.left),this.viewport.bottom=Math.floor(this._rendererSize.y*this.viewportNormalized.bottom),this.viewport.width=Math.floor(this._rendererSize.x*this.viewportNormalized.width),this.viewport.height=Math.floor(this._rendererSize.y*this.viewportNormalized.height)):(this.viewport.width=this._rendererSize.x,this.viewport.height=this._rendererSize.y),this.scene.__needsRender=!0}onBeforeRender(){void 0!==this._onBeforeRender&&this._onBeforeRender()}onAfterRender(){void 0!==this._onAfterRender&&this._onAfterRender()}}class tt{get activeView(){return this._activeView||this.__defaultView}get backgroundColor(){return this._backgroundColor}set backgroundColor(t){this._backgroundColor="number"==typeof t?new a.Color(t):t,this.renderer.setClearColor(this._backgroundColor,this._backgroundAlpha)}get backgroundAlpha(){return this._backgroundAlpha}set backgroundAlpha(t){this._backgroundAlpha=t,this.renderer.setClearColor(this._backgroundColor,this._backgroundAlpha)}constructor(t,e,i=0,s=1){this.views=[],this._visibleScenes=new C,this._rendererSize=new a.Vector2,this.renderer=t,this._fullscreen=e,this._backgroundAlpha=s,this._backgroundColor="number"==typeof i?new a.Color(i):i,window.addEventListener("resize",this.onResize.bind(this)),this.updateRenderSize(),this.renderer.setClearColor(this._backgroundColor,this._backgroundAlpha)}add(t){const e=new J(t,this._rendererSize);return this.views.push(e),e}getByName(t){for(let e=0;e<this.views.length;e++)if(this.views[e].name===t)return this.views[e]}remove(t){const e=this.views.indexOf(t);-1!==e&&this.views.splice(e,1),0===this.views.length&&this.setDefaultRendererParameters()}removeByName(t){for(let e=0;e<this.views.length;e++)if(this.views[e].name===t)return this.views.splice(e,1),void(0===this.views.length&&this.setDefaultRendererParameters())}clear(){this.views=[],this.setDefaultRendererParameters()}setDefaultRendererParameters(){this.renderer.setScissorTest(!1),this.renderer.setViewport(0,0,this._rendererSize.width,this._rendererSize.height),this.renderer.setScissor(0,0,this._rendererSize.width,this._rendererSize.height),this.renderer.setClearColor(this._backgroundColor,this._backgroundAlpha)}getVisibleScenes(){if(0!==this.views.length){this._visibleScenes.clear();for(const t of this.views)!0===t.visible&&this._visibleScenes.push(t.scene);return this._visibleScenes.data}}updateActiveView(t){const e=this.getViewByMouse(t);void 0!==e&&(this._activeView=e)}getViewByMouse(t){for(let e=this.views.length-1;e>=0;e--){const i=this.views[e],s=i.viewport;if(!0===i.visible&&s.left<=t.x&&s.left+s.width>=t.x&&s.bottom<=t.y&&s.bottom+s.height>=t.y)return i}}getNormalizedMouse(t,e){if(this.updateActiveView(t),void 0===this.activeView)return!1;const i=this.activeView.viewport;return e.set((t.x-i.left)/i.width*2-1,(t.y-i.bottom)/i.height*-2+1),!0}render(){var t,e;let i=!1;if(this.views.length>0){for(const s of this.views)if(!0===s.visible&&!0===s.scene.__needsRender){const r=s.viewport;this.renderer.setScissorTest(void 0!==s.viewportNormalized),this.renderer.setViewport(r.left,r.bottom,r.width,r.height),this.renderer.setScissor(r.left,r.bottom,r.width,r.height),this.renderer.setClearColor(null!==(t=s.backgroundColor)&&void 0!==t?t:this._backgroundColor,null!==(e=s.backgroundAlpha)&&void 0!==e?e:this._backgroundAlpha),s.onBeforeRender(),this.executeRender(s.scene,s.camera,s.composer),s.onAfterRender(),i||(i=!0)}}else!0===this.__defaultView.scene.__needsRender&&(this.executeRender(this.__defaultView.scene,this.__defaultView.camera),i||(i=!0));return i}executeRender(t,e,i){void 0!==i?i.render():this.renderer.render(t,e)}onResize(){var t;this.updateRenderSize(),null===(t=this.__defaultView)||void 0===t||t.update();for(const t of this.views)t.update()}updateRenderSize(){if(!0===this._fullscreen)this.renderer.setSize(window.innerWidth,window.innerHeight);else{const{width:t,height:e}=this.renderer.domElement.getBoundingClientRect();this.renderer.setSize(t,e,!1)}this.renderer.getSize(this._rendererSize)}createDefaultRenderView(t,e,i){this.__defaultView=new J({scene:t,camera:e,composer:i},this._rendererSize)}}class et{get activeScene(){return this.renderManager.activeView.scene}get activeCamera(){return this.renderManager.activeView.camera}get activeComposer(){return this.renderManager.activeView.composer}get showStats(){return this._showStats}set showStats(t){!0===t?(void 0===this._stats&&(this._stats=new c),document.body.appendChild(this._stats.dom)):void 0!==this._stats&&document.body.removeChild(this._stats.dom),this._showStats=t}get backgroundColor(){return this.renderManager.backgroundColor}set backgroundColor(t){this.renderManager.backgroundColor=t}get backgroundAlpha(){return this.renderManager.backgroundAlpha}set backgroundAlpha(t){this.renderManager.backgroundAlpha=t}constructor(t={},e={}){var i,s,r;this.scenes=[],this._clock=new a.Clock,this.initRenderer(t.fullscreen,e),this.interactionManager=new Y(this.renderManager),this.appendCanvas(e),this.handleContextMenu(t.disableContextMenu),this.showStats=null===(i=t.showStats)||void 0===i||i,this.addScene(...t.scenes),this.setAnimationLoop(),this.backgroundColor=null!==(s=t.backgroundColor)&&void 0!==s?s:0,this.backgroundAlpha=null!==(r=t.backgroundAlpha)&&void 0!==r?r:1,this._animate=t.animate}initRenderer(t=!0,e){this.renderer=new a.WebGLRenderer(e),this.renderer.setPixelRatio(window.devicePixelRatio),Z(this.renderer),this.renderManager=new tt(this.renderer,t)}appendCanvas(t){void 0===t.canvas&&document.body.appendChild(this.renderer.domElement)}handleContextMenu(t=!0){!0===t&&this.renderer.domElement.addEventListener("contextmenu",(t=>t.preventDefault()))}addScene(...t){if(this.scenes.push(...t),0===this.renderManager.views.length&&void 0===this.renderManager.__defaultView)for(const e of t[0].children)if(!0===e.isCamera){this.createDefaultRenderView(t[0],e);break}}setAnimationLoop(){this.renderer.setAnimationLoop(((t,e)=>{var i;et.ticks++,this.interactionManager.update();const s=null!==(i=this.renderManager.getVisibleScenes())&&void 0!==i?i:[this.activeScene];for(const t of s)P.dispatchEvent(t,"animate",{delta:this._clock.getDelta(),total:this._clock.getElapsedTime()});this.animate(t,e);const r=this.renderManager.render();for(const t of s)t.__needsRender=!t.__smartRendering;!0===this._showStats&&this._stats.update(r)}))}animate(t,e){void 0!==this._animate&&this._animate(t,e)}createDefaultRenderView(t,e,i){this.renderManager.createDefaultRenderView(t,e,i)}}et.ticks=0;class it{static bindProperty(t,e,i,s){if(-1!==this.getIndexByKey(e,t))return void console.error("Cannot override property already bound.");const r=i.bind(e);this.defineProperty(t,r,e,s),this.addToBoundCallbacks(t,r,e,s)}static getIndexByKey(t,e){const i=t.__boundCallbacks;if(void 0===i)return-1;for(let t=0;t<i.length;t++)if(i[t].key===e)return t;return-1}static defineProperty(t,e,i,s){!0===i.__manualDetection?this.definePropertyManualDetection(t,i):this.definePropertyAutoDetection(t,e,i,s)}static definePropertyManualDetection(t,e){const i=`__bound__${t}`;Object.defineProperty(e,t,{get:function(){return this[i]},configurable:!0})}static definePropertyAutoDetection(t,e,i,s){const r=`__bound__${t}`,n=`__lastTick_${t}`;!0===s?Object.defineProperty(i,t,{get:function(){if(this[n]!==et.ticks){const t=e();this[n]=et.ticks,t!==this[r]&&(this[r]=t,this.__scene.__needsRender=!0)}return this[r]},configurable:!0}):Object.defineProperty(i,t,{get:function(){return this[n]!==et.ticks&&(this[r]=e(),this[n]=et.ticks),this[r]},configurable:!0})}static addToBoundCallbacks(t,e,i,s){var r;const n=null!==(r=i.__boundCallbacks)&&void 0!==r?r:i.__boundCallbacks=[],a=`__bound__${t}`;let o;o=!0===s?()=>{const t=e();t!==i[a]&&(i[a]=t,i.__scene.__needsRender=!0)}:()=>{i[a]=e()},n.push({key:t,setValue:o}),!0===i.__manualDetection&&o()}static detectChanges(t){for(const e of t.__boundCallbacks)e.setValue()}static unbindProperty(t,e){const i=this.getIndexByKey(t,e);if(-1!==i){t.__boundCallbacks.splice(i,1);const s=`__bound__${e}`,r=`__lastTick_${e}`;Object.defineProperty(t,e,{value:t[s],writable:!0,configurable:!0}),delete t[s],delete t[r]}}static setManualDetectionMode(t){if(!0!==t.__manualDetection){if(void 0!==t.__boundCallbacks)for(const e of t.__boundCallbacks)this.definePropertyManualDetection(e.key,t);t.__manualDetection=!0}}}const st=()=>function(t,e,i){if(void 0!==i.get){const s=i.get;delete t[e],delete i.get,delete i.set,delete i.configurable,t.bindProperty(e,s)}},rt=()=>t=>class extends t{constructor(){super(),this.setManualDetectionMode()}};class nt extends a.ShaderMaterial{constructor(t){super({uniforms:{map:{value:null==t?void 0:t.map},resolution:{value:null==t?void 0:t.resolution},time:{value:0}}}),this.vertexShader="\n    varying vec3 radius;\n    varying vec3 vNormal;\n    varying vec2 vUv;\n  \n    uniform float time;\n  \n    void main() {\n      vec3 noise = vec3(abs(sin(time / 2.0 + position.x)) * 0.1, abs(cos(time / 2.0 + position.x)) * 0.1 ,0.0);\n      vUv = uv;\n      vNormal = vec3(0.0 , 0.0,-1.0);\n      gl_Position = projectionMatrix * modelViewMatrix * vec4(position + noise, 1.0);\n    }",this.fragmentShader="\n    uniform sampler2D map;\n    uniform vec2 resolution;\n    varying vec3 vNormal;\n    varying vec2 vUv;\n  \n    vec3 getNormal(vec2 point2D, float radius) {\n      float x = (point2D.x - 0.5) * 2.0 * radius;\n      float y = (point2D.y - 0.5) * 2.0 * radius;\n      float z = sqrt(max(0.0, radius * radius - x * x - y * y));\n          return vec3(x, y, z); \n      }\n  \n  \n    void main() {\n      vec2 uv = gl_FragCoord.xy / resolution.xy;\n  \n      vec3 normal =  getNormal(vUv,1.0);\n  \n      // gl_FragColor = vec4(0.0 ,vUv.x,0.0,1.0);\n      // return;\n  \n      float iorRatioR = 0.9900;\n      float iorRatioG = 0.9910;\n      float iorRatioB = 0.9920;\n      vec2 center = vec2(0.5,0.5);\n      float distance = distance(center,vUv);\n  \n      if(distance > 0.495){\n          gl_FragColor = vec4(0.0,0.0,0.0,0.1);\n          return;\n      }\n  \n      \n  \n      vec3 refractVecR = refract(vNormal,normal,iorRatioR);\n      vec3 refractVecG = refract(vNormal,normal,iorRatioG);\n      vec3 refractVecB = refract(vNormal,normal,iorRatioB);\n      vec4 color = vec4(0.0);\n      color.r = texture2D(map, uv.xy + refractVecR.xy).r;\n      color.g = texture2D(map, uv.xy + refractVecG.xy).g;\n      color.b = texture2D(map, uv.xy + refractVecB.xy).b;\n      color.a = 1.0;\n      gl_FragColor = color;\n      }"}setResolution(t,e){this.uniforms.resolution.value||(this.uniforms.resolution.value=new a.Vector2),this.uniforms.resolution.value.set(t,e)}setTexture(t){this.uniforms.map.value=t}setTime(t){this.uniforms.time.value=t}}class at extends a.InstancedMesh{constructor(t,e,i,s,r){super(t,e,i),this.instances=[],this._tempMatrix=new a.Matrix4,this._tempColor=new a.Color,this._needsUpdate=!1,"number"==typeof r&&(r=this._tempColor.setHex(r));for(let t=0;t<i;t++)this.instances.push(new s(this,t,r));this.bindEvent("pointerintersection",(t=>{this.instances[t.intersection.instanceId].triggerEvent("pointerintersection",t)})),this.bindEvent("animate",(t=>{for(let e=0;e<this.count;e++)this.instances[e].triggerEvent("animate",t)}))}}let ot=1;class ht extends a.EventDispatcher{get activableObj(){return this.activable?this:this.parent.activableObj}constructor(t,e,i){super(),this.position=new a.Vector3,this.scale=new a.Vector3(1,1,1),this.quaternion=new a.Quaternion,this.activable=!1,this.active=!1,this.hovered=!1,this.enabled=!0,this.id=ot++,this.parent=t,this.instanceId=e,this.__eventsDispatcher=new E(this),i&&this.setColor(i)}setColor(t){"number"==typeof t?this.parent.setColorAt(this.instanceId,this.parent._tempColor.setHex(t)):this.parent.setColorAt(this.instanceId,t),this.parent.instanceColor.needsUpdate=!0}getColor(t=this.parent._tempColor){return this.parent.getColorAt(this.instanceId,t),t}updateMatrix(){const t=this.parent._tempMatrix;t.compose(this.position,this.quaternion,this.scale),this.parent.setMatrixAt(this.instanceId,t),this.parent.instanceMatrix.needsUpdate=!0}bindEvent(t,e){if("string"==typeof t)return this.__eventsDispatcher.addEventListener(t,e);for(const i of t)this.__eventsDispatcher.addEventListener(i,e);return e}hasBoundEvent(t,e){return this.__eventsDispatcher.hasEventListener(t,e)}unbindEvent(t,e){this.__eventsDispatcher.removeEventListener(t,e)}triggerEvent(t,e){this.__eventsDispatcher.dispatchEvent(t,e)}}const ct=(t=>{var e={};return r.d(e,t),e})({Line2:()=>e.Line2}),lt=(t=>{var e={};return r.d(e,t),e})({LineGeometry:()=>i.LineGeometry}),dt=(t=>{var e={};return r.d(e,t),e})({LineMaterial:()=>s.LineMaterial});class ut extends ct.Line2{constructor(t=new dt.LineMaterial){super(new lt.LineGeometry,t),this.bindEvent("rendererresize",(t=>{this.material.resolution.set(t.width,t.height)}))}updatePoints(t,...e){const i=this.geometry.attributes.instanceStart.array;for(const s of e){const e=6*(s-1)+3;i[e]=t[s].x,i[e+1]=t[s].y,i[e+2]=t[s].z,i[e+3]=t[s].x,i[e+4]=t[s].y,i[e+5]=t[s].z}this.geometry.attributes.instanceStart.needsUpdate=!0,this.geometry.attributes.instanceEnd.needsUpdate=!0,this.update()}setPoints(t){this.createAttributes(t)||(this.fillFloat32Array(t,this.geometry.attributes.instanceStart.array),this.geometry.attributes.instanceStart.needsUpdate=!0,this.geometry.attributes.instanceEnd.needsUpdate=!0),this.update()}createAttributes(t){var e;if((null===(e=this.geometry.getAttribute("instanceStart"))||void 0===e?void 0:e.count)!==t.length-1){const e=this.fillFloat32Array(t),i=new a.InstancedInterleavedBuffer(e,6,1);return this.geometry.setAttribute("instanceStart",new a.InterleavedBufferAttribute(i,3,0)),this.geometry.setAttribute("instanceEnd",new a.InterleavedBufferAttribute(i,3,3)),delete this.geometry._maxInstanceCount,!0}}fillFloat32Array(t,e){var i,s;null!=e||(e=new Float32Array(3*(t.length-1)*2));for(let r=0;r<t.length-1;r++){const n=6*r;e[n]=t[r].x,e[n+1]=t[r].y,e[n+2]=null!==(i=t[r].z)&&void 0!==i?i:0,e[n+3]=t[r+1].x,e[n+4]=t[r+1].y,e[n+5]=null!==(s=t[r+1].z)&&void 0!==s?s:0}return e}update(){this.geometry.computeBoundingBox(),this.geometry.computeBoundingSphere()}}class _t extends ut{constructor(t,e){super(),t.bindEvent("positionchange",(()=>{this._needsUpdate=!0})),e.bindEvent("positionchange",(()=>{this._needsUpdate=!0})),this.bindEvent("animate",(()=>{this._needsUpdate&&(this.setPoints([t.position,e.position]),this._needsUpdate=!1)}))}}class pt extends a.ShaderMaterial{constructor(t,e,i){super(),this.vertexShader="\n        varying vec2 vUv;\n\n\t\tvoid main() {\n            vUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n\t\t}",this.fragmentShader="\n        uniform vec3 empty;\n        uniform vec3 fill;\n        uniform float percentage;\n        uniform float time;\n        uniform float height;\n        varying vec2 vUv;\n\n        void main() {\n            if (vUv.y > percentage) {\n                gl_FragColor = vec4(empty + (sin(vUv.y * height + time) * 0.2 - 0.1), 1.0);\n            } else {\n                gl_FragColor = vec4(fill + (cos(vUv.y * height + time) * 0.2 - 0.1), 1.0);\n            }\n        }",this.uniforms={empty:{value:new a.Color(e)},fill:{value:new a.Color(i)},percentage:{value:0},time:{value:0},height:{value:t}}}setPercentage(t){this.uniforms.percentage.value=t}}class gt extends a.OrthographicCamera{constructor(t=100,e,i){super(void 0,void 0,void 0,void 0,e,i),this.bindEvent("rendererresize",(e=>{const i=e.width/e.height;this.left=-.5*t*i,this.right=.5*t*i,this.top=t/2,this.bottom=t/-2,this.updateProjectionMatrix()}))}}class vt extends a.PerspectiveCamera{constructor(t,e,i){super(t,void 0,e,i),this.bindEvent("rendererresize",(t=>{this.aspect=t.width/t.height,this.updateProjectionMatrix()}))}}a.Scene.prototype.activable=!1,a.Scene.prototype.__needsRender=!0,a.Scene.prototype.__smartRendering=!1,a.Scene.prototype.activeSmartRendering=function(){return this.__smartRendering=!0,this};class mt{easeInSine(t){return 1-Math.cos(t*Math.PI/2)}easeOutSine(t){return Math.sin(t*Math.PI/2)}easeInOutSine(t){return-(Math.cos(Math.PI*t)-1)/2}easeInQuad(t){return t*t}easeOutQuad(t){return 1-(1-t)*(1-t)}easeInOutQuad(t){return t<.5?2*t*t:1-Math.pow(-2*t+2,2)/2}easeInCubic(t){return t*t*t}easeOutCubic(t){return 1-Math.pow(1-t,3)}easeInOutCubic(t){return t<.5?4*t*t*t:1-Math.pow(-2*t+2,3)/2}easeInQuart(t){return t*t*t*t}easeOutQuart(t){return 1-Math.pow(1-t,4)}easeInOutQuart(t){return t<.5?8*t*t*t*t:1-Math.pow(-2*t+2,4)/2}easeInQuint(t){return t*t*t*t*t}easeOutQuint(t){return 1-Math.pow(1-t,5)}easeInOutQuint(t){return t<.5?16*t*t*t*t*t:1-Math.pow(-2*t+2,5)/2}easeInExpo(t){return 0===t?0:Math.pow(2,10*t-10)}easeOutExpo(t){return 1===t?1:1-Math.pow(2,-10*t)}easeInOutExpo(t){return 0===t?0:1===t?1:t<.5?Math.pow(2,20*t-10)/2:(2-Math.pow(2,-20*t+10))/2}easeInCirc(t){return 1-Math.sqrt(1-Math.pow(t,2))}easeOutCirc(t){return Math.sqrt(1-Math.pow(t-1,2))}easeInOutCirc(t){return t<.5?(1-Math.sqrt(1-Math.pow(2*t,2)))/2:(Math.sqrt(1-Math.pow(-2*t+2,2))+1)/2}easeInBack(t){return 2.70158*t*t*t-1.70158*t*t}easeOutBack(t){return 1+2.70158*Math.pow(t-1,3)+1.70158*Math.pow(t-1,2)}easeInOutBack(t){const e=2.5949095;return t<.5?Math.pow(2*t,2)*(7.189819*t-e)/2:(Math.pow(2*t-2,2)*((e+1)*(2*t-2)+e)+2)/2}easeInElastic(t){return 0===t?0:1===t?1:-Math.pow(2,10*t-10)*Math.sin((10*t-10.75)*(2*Math.PI)/3)}easeOutElastic(t){return 0===t?0:1===t?1:Math.pow(2,-10*t)*Math.sin((10*t-.75)*(2*Math.PI)/3)+1}easeInOutElastic(t){const e=2*Math.PI/4.5;return 0===t?0:1===t?1:t<.5?-Math.pow(2,20*t-10)*Math.sin((20*t-11.125)*e)/2:Math.pow(2,-20*t+10)*Math.sin((20*t-11.125)*e)/2+1}easeInBounce(t){return 1-this.easeOutBounce(1-t)}easeOutBounce(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375}easeInOutBounce(t){return t<.5?(1-this.easeOutBounce(1-2*t))/2:(1+this.easeOutBounce(2*t-1))/2}}var ft=n.WY,bt=n.KX,yt=n.w9,xt=n.LK,wt=n.x$,Mt=n.Or,Ct=n.ZB,Pt=n.z2,Et=n.H7,zt=n.wO,Dt=n.Ex,kt=n.kX,Rt=n.SP,St=n.td,Ot=n.hP,It=n.bx,At=n.l_,Tt=n.w_,jt=n.av,Vt=n.Ns,Ht=n.or,Lt=n.tg,Bt=n.gb,Gt=n.iK,Ut=n.s_,Wt=n.cP,Ft=n.DJ,Xt=n.RR,qt=n.$C,Kt=n.zo,Nt=n.bU,Yt=n.MZ,Qt=n.jk,$t=n.tL,Zt=n.Xp,Jt=n.DS,te=n.NP,ee=n.bn,ie=n.uF,se=n.EU,re=n.Lz,ne=n.zh,ae=n.jp,oe=n.wN,he=n.BF,ce=n.BD,le=n.eH,de=n.KJ,ue=n.dz;export{ft as Bind,bt as Binding,yt as BubbleMaterial,xt as CursorHandler,wt as DistinctTargetArray,Mt as DragAndDropManager,Ct as DragEventExt,Pt as Easings,Et as EventExt,zt as EventsCache,Dt as EventsDispatcher,kt as FocusEventExt,Rt as InstancedMesh,St as InstancedMeshSingle,Ot as InteractionEventsQueue,It as InteractionManager,At as KeyboardEventExt,Tt as Line2,jt as LinkedLine,Vt as LoadingMaterial,Ht as Main,Lt as ManualDetection,Bt as MouseEventExt,Gt as OrthographicCamera,Ut as Panel,Wt as PerspectiveCamera,Ft as PointerEventExt,Xt as PointerIntersectionEvent,qt as RaycasterManager,Kt as RenderManager,Nt as RenderView,Yt as RendererResizeEvent,Qt as Stats,$t as WheelEventExt,Zt as applyEulerPatch,Jt as applyMatrix4Patch,te as applyObject3DRotationPatch,ee as applyObject3DVector3Patch,ie as applyQuaternionPatch,se as applyVector3Patch,re as applyWebGLRendererPatch,ne as object3DList,ae as setEulerDefaultChangeCallback,oe as setEulerSmartRenderingChangeCallback,he as setQuaternionDefaultChangeCallback,ce as setQuaternionSmartRenderingChangeCallback,le as setSceneReference,de as setVector3DefaultChangeCallback,ue as setVector3SmartRenderingChangeCallback};